<!DOCTYPE html>
<html lang="en" class="colors theme-dark-2 entities fonts code-style"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark">

    <!-- cache -->
    <meta http-equiv="Cache-Control" content="max-age=86400, must-revalidate" />    

    <!-- Pridanie Slick Carousel CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" />
    <!-- Pridanie Slick Carousel Theme CSS (voliteľné) -->
    <link rel="stylesheet" type="text/css"
        href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css" />
    <!-- Pridanie jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Pridanie Lightbox CSS a JS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox-plus-jquery.min.js"></script>
    <!-- Pridanie Slick Carousel JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css">

    <!-- IMPORTANT -->
    <script src="https://use.fontawesome.com/ee196462b9.js"></script>

    <!-- keywoards -->
    

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FYN9BGS01R"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-FYN9BGS01R');
    </script>

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Distribuovanie vašej knižnice spolu s Roslyn analyzérom | Burgyn’s blog</title>
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="Distribuovanie vašej knižnice spolu s Roslyn analyzérom" />
<meta name="author" content="Milan Martiniak" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Roslyn .NET kompilačná platforma je tu s nami už zhruba od roku 2011, keď bol zverejnený prvý public download. Odvtedy prešla dlhá doba a jednou pre nás zajznámejšou “vychytávkou” je možnosť písať vlastné analyzéri a k ním prísluchajúce code fixe provideri. Veľa z nás si vyskúšalo spraviť vlastný analyzér, kontrolovanie if-bloku, generovanie fieldu z parametrov konštruktoru, … V súčasnej dobe keď máme k dispozícií .editorconfig a množstvo pripravených analyzérov či už priamo od Microsoftu, alebo projektov ako je napríklad Roslynator, tak potreba písať vlastné analyzéri upadla. Pravdepodobne na väčšinu vaších problémov už nejaký existuje." />
<meta property="og:description" content="Roslyn .NET kompilačná platforma je tu s nami už zhruba od roku 2011, keď bol zverejnený prvý public download. Odvtedy prešla dlhá doba a jednou pre nás zajznámejšou “vychytávkou” je možnosť písať vlastné analyzéri a k ním prísluchajúce code fixe provideri. Veľa z nás si vyskúšalo spraviť vlastný analyzér, kontrolovanie if-bloku, generovanie fieldu z parametrov konštruktoru, … V súčasnej dobe keď máme k dispozícií .editorconfig a množstvo pripravených analyzérov či už priamo od Microsoftu, alebo projektov ako je napríklad Roslynator, tak potreba písať vlastné analyzéri upadla. Pravdepodobne na väčšinu vaších problémov už nejaký existuje." />
<link rel="canonical" href="https://blog.burgyn.online/2020/11/04/distribuovanie-va%C5%A1ej-kni%C5%BEnice-spolu-s-roslyn-analyz%C3%A9rom" />
<meta property="og:url" content="https://blog.burgyn.online/2020/11/04/distribuovanie-va%C5%A1ej-kni%C5%BEnice-spolu-s-roslyn-analyz%C3%A9rom" />
<meta property="og:site_name" content="Burgyn’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-11-04T08:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Distribuovanie vašej knižnice spolu s Roslyn analyzérom" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Milan Martiniak","url":"https://burgyn.bio.link/"},"dateModified":"2020-11-04T08:00:00+00:00","datePublished":"2020-11-04T08:00:00+00:00","description":"Roslyn .NET kompilačná platforma je tu s nami už zhruba od roku 2011, keď bol zverejnený prvý public download. Odvtedy prešla dlhá doba a jednou pre nás zajznámejšou “vychytávkou” je možnosť písať vlastné analyzéri a k ním prísluchajúce code fixe provideri. Veľa z nás si vyskúšalo spraviť vlastný analyzér, kontrolovanie if-bloku, generovanie fieldu z parametrov konštruktoru, … V súčasnej dobe keď máme k dispozícií .editorconfig a množstvo pripravených analyzérov či už priamo od Microsoftu, alebo projektov ako je napríklad Roslynator, tak potreba písať vlastné analyzéri upadla. Pravdepodobne na väčšinu vaších problémov už nejaký existuje.","headline":"Distribuovanie vašej knižnice spolu s Roslyn analyzérom","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.burgyn.online/2020/11/04/distribuovanie-va%C5%A1ej-kni%C5%BEnice-spolu-s-roslyn-analyz%C3%A9rom"},"url":"https://blog.burgyn.online/2020/11/04/distribuovanie-va%C5%A1ej-kni%C5%BEnice-spolu-s-roslyn-analyz%C3%A9rom"}</script>
<!-- End Jekyll SEO tag -->


    


    <!-- CSS -->
    <link rel="stylesheet" href="/assets/main.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/assets/android-chrome-512x512.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/android-chrome-192x192.png">
    <link rel="android-chrome-192x192" type="image/png" sizes="192x192" href="/assets/android-chrome-192x192.png">
    <link rel="android-chrome-512x512" type="image/png" sizes="512x512" href="/assets/android-chrome-512x512.png">

    <!-- PWA -->
    <link rel="manifest" href="/assets/manifest.json">

    <!-- RSS -->
    <link type="application/atom+xml" rel="alternate" href="https://blog.burgyn.online/feed.xml" title="Burgyn's blog" />

    <!-- Google Analytics-->
    
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'dark'
        });
    </script>
</head><body>
    <svg width="0" height="0">
        <defs>
            <marker id="custom-arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
            <path d="M0,0 L0,7 L10,3.5 z"></path>
            </marker>
        </defs>
    </svg>
    <nav class="nav">
  <div class="nav-container">
    <a href="/">
      <div class="site-name">
        <img src="/assets/android-chrome-192x192.png" alt="Burgyn's logo" class="nav-logo">
        <h2 class="nav-title">Burgyn's blog</h2>
      </div>
    </a>    
    <ul>
      <li><a href="/">Posts</a></li>
      <li><a href="/about/">About me</a></li>
    </ul>
  </div>
</nav>

    <main class="page-content" aria-label="Content">
        <div class="wrapper">
            <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <header class="post-header">
        <h1 class="post-title p-name" itemprop="name headline"><p>Distribuovanie vašej knižnice spolu s Roslyn analyzérom</p>
</h1>
        <p class="post-meta">
            <time class="dt-published" datetime="2020-11-04T08:00:00+00:00" itemprop="datePublished">Nov 4, 2020
            </time><span itemprop="author" itemscope
                itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name"> | Milan Martiniak</span></span>
            | <span class="fa fa-tags" aria-label="Tags"> </span> 
            <span>
                <!-- <a href="/tags/Roslyn">Roslyn</a> -->
                Roslyn, 
            </span> 
            <span>
                <!-- <a href="/tags/C#">C#</a> -->
                C#, 
            </span> 
            <span>
                <!-- <a href="/tags/.NET Core">.NET Core</a> -->
                .NET Core, 
            </span> 
            <span>
                <!-- <a href="/tags/NuGet">NuGet</a> -->
                NuGet
            </span>  
        </p>
    </header>

    

    <div class="post-content e-content" itemprop="articleBody">
        <p>Roslyn .NET kompilačná platforma je tu s nami už zhruba od roku 2011, keď bol zverejnený prvý public download. Odvtedy prešla dlhá doba a jednou pre nás zajznámejšou “vychytávkou” je možnosť písať vlastné analyzéri a k ním prísluchajúce code fixe provideri. Veľa z nás si vyskúšalo spraviť vlastný analyzér, kontrolovanie if-bloku, generovanie fieldu z parametrov konštruktoru, … V súčasnej dobe keď máme k dispozícií <code class="highlighter-rouge">.editorconfig</code> a množstvo pripravených analyzérov či už priamo od Microsoftu, alebo projektov ako je napríklad <a href="https://github.com/JosefPihrt/Roslynator">Roslynator</a>, tak potreba písať vlastné analyzéri upadla. Pravdepodobne na väčšinu vaších problémov už nejaký existuje.</p>

<p>To kde to má stále veľký zmysel sú vaše vlastné knižnice. Vy ako autor knižnice viete ako sa má knižnica používať. Čomu sa vyvarovať kvôli výkonu, bezpečnosti. Možno viete dať odporúčanie aký dodržiavať code style kvôli ďalším tool-om, ktoré máte napríklad na automatizovanie generovania dokumentácie. V takomto prípade by ste chceli analyzér distribuovať priamo s vašou knižnicou v jednom NuGet balíčku.</p>

<p>V tomto článku nebudem písať o tom ako si vytvoriť vlastný Roslyn analyzér, o tom je už dosť článkov a videií. (Aj na našom <a href="https://www.youtube.com/watch?v=Rv90NaTxv0E">Dev Meetupe o tom rozprával Jirko Činčura</a>.) Ja sa budem venovať tomu ako to celé zabaliť do jedného NuGet balíčku, aby konzumér vášho balíčku po jeho inštalácií mal rovno nainštalovaný aj prislúchajúci analyzér.</p>

<h2 id="demo-projekt">Demo projekt</h2>

<p>Demo projekt sa nachádza na <a href="https://github.com/Burgyn/Sample.PackageWithRoslynAnalyzer">GitHube</a>. Pozostáva z dvoch projektov:</p>

<ul>
  <li><code class="highlighter-rouge">Sample.MyFancyPackage</code> - vymyslená knižnica, s dummy funkčnosťou, na ktorú som napísal analyzér. <code class="highlighter-rouge">.net core</code></li>
  <li><code class="highlighter-rouge">Sample.MyFancyPackageAnalyzer</code> - analyzér spolu s code fix provider-om pre knižnicu <code class="highlighter-rouge">Sample.MyFancyPackage</code></li>
</ul>

<h2 id="ako-na-to">Ako na to</h2>

<p>Potrebujeme vytvoriť priečinok v hlavnom projekte <em>(projekt, predstavujúci vašu knižnicu)</em> a do neho pridať dva powershell scripty:</p>
<ul>
  <li>install.ps1</li>
  <li>uninstall.ps1</li>
</ul>

<blockquote>
  <p>Sú to scripty, ktoré vytvorí šablóna na vytvorenie Roslyn analyzéru. Taktiež sú dostupné <a href="https://docs.microsoft.com/en-us/nuget/guides/analyzers-conventions#install-and-uninstall-scripts">v dokumentácií</a>.</p>
</blockquote>

<h3 id="úprava-csproj-súboru-vašej-knižnice">Úprava <code class="highlighter-rouge">csproj</code> súboru vašej knižnice</h3>

<p>Predpokladám, že vašu knižnicu distribujete ako NuGet balíček. V tom prípade už máte v sekcii <code class="highlighter-rouge">&lt;PropertyGroup&gt;</code> pridané nastavenie na generovanie balíčka.</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;GeneratePackageOnBuild&gt;</span>true<span class="nt">&lt;/GeneratePackageOnBuild&gt;</span>
</code></pre></div></div>

<p>Ďalej potrebujeme zabezpečiť aby sa spolu s vašou knužnicou build-oval aj analyzér. To môžte spraviť tak, že jednoducho pridáte referenciu na projekt. V tom prípade sa vám v NuGet balíčku vytvorí závislosť na balíčku vášho analyzéra. Čo v prípade, že analyzér nechcete distribuovať aj samostatne nieje žiadúce. Preto môžte závislosť definovať nasledovne.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ItemGroup&gt;</span>
  <span class="nt">&lt;ProjectReference</span> <span class="na">Include=</span><span class="s">"..\Sample.MyFancyPackageAnalyzer\Sample.MyFancyPackageAnalyzer\Sample.MyFancyPackageAnalyzer.csproj"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ReferenceOutputAssembly&gt;</span>true<span class="nt">&lt;/ReferenceOutputAssembly&gt;</span>
    <span class="nt">&lt;IncludeAssets&gt;</span>Sample.MyFancyPackageAnalyzer.dll<span class="nt">&lt;/IncludeAssets&gt;</span>
  <span class="nt">&lt;/ProjectReference&gt;</span>
<span class="nt">&lt;/ItemGroup&gt;</span>
</code></pre></div></div>

<p>Pomocou takejto referencie zabezpečíte, že analyzér sa bude build-ovať spolu s vašou knižnicou a jeho dll-ka sa dostane do outputu vášho projektu.</p>

<p>Dll-ku analyzéra potrebujeme nakopírovať na prísluchajúce miesto. Microsoft má <a href="https://docs.microsoft.com/en-us/nuget/guides/analyzers-conventions#analyzers-path-format">odporúčané konvencie</a> kam sa majú tieto analyzéri umiestňovať. V našom prípade to bude <code class="highlighter-rouge">analyzers/dotnet/cs</code>.
Docielíme to tak, že do <code class="highlighter-rouge">csproj</code> vašej knižnice pridáme nasledujúcu sekciu.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"_AddAnalyzersToOutput"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;TfmSpecificPackageFile</span> <span class="na">Include=</span><span class="s">"$(OutputPath)\Sample.MyFancyPackageAnalyzer.dll"</span> <span class="na">PackagePath=</span><span class="s">"analyzers/dotnet/cs"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>
<span class="nt">&lt;/Target&gt;</span>
</code></pre></div></div>

<p>A použijeme ju v <code class="highlighter-rouge">&lt;PropertyGroup&gt;</code> nasledovne:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;TargetsForTfmSpecificContentInPackage&gt;</span>$(TargetsForTfmSpecificContentInPackage);_AddAnalyzersToOutput<span class="nt">&lt;/TargetsForTfmSpecificContentInPackage&gt;</span>
</code></pre></div></div>

<p>Potom nám už ostáva zabezpečiť aby sa nám aj scripty z nášho <code class="highlighter-rouge">tools</code> adresára dostali do outputu.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ItemGroup&gt;</span>
  <span class="nt">&lt;None</span> <span class="na">Update=</span><span class="s">"tools\*.ps1"</span> <span class="na">CopyToOutputDirectory=</span><span class="s">"Always"</span> <span class="na">Pack=</span><span class="s">"true"</span> <span class="na">PackagePath=</span><span class="s">"tools"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/ItemGroup&gt;</span>
</code></pre></div></div>

<p>Výsledný <code class="highlighter-rouge">csproj</code> môže vyzerať nasledovne:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;TargetFramework&gt;</span>netcoreapp3.1<span class="nt">&lt;/TargetFramework&gt;</span>
    <span class="nt">&lt;TargetsForTfmSpecificContentInPackage&gt;</span>$(TargetsForTfmSpecificContentInPackage);_AddAnalyzersToOutput<span class="nt">&lt;/TargetsForTfmSpecificContentInPackage&gt;</span>
    <span class="nt">&lt;GeneratePackageOnBuild&gt;</span>true<span class="nt">&lt;/GeneratePackageOnBuild&gt;</span>
  <span class="nt">&lt;/PropertyGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;ProjectReference</span> <span class="na">Include=</span><span class="s">"..\Sample.MyFancyPackageAnalyzer\Sample.MyFancyPackageAnalyzer\Sample.MyFancyPackageAnalyzer.csproj"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ReferenceOutputAssembly&gt;</span>true<span class="nt">&lt;/ReferenceOutputAssembly&gt;</span>
      <span class="nt">&lt;IncludeAssets&gt;</span>Sample.MyFancyPackageAnalyzer.dll<span class="nt">&lt;/IncludeAssets&gt;</span>
    <span class="nt">&lt;/ProjectReference&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>

  <span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"_AddAnalyzersToOutput"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ItemGroup&gt;</span>
      <span class="nt">&lt;TfmSpecificPackageFile</span> <span class="na">Include=</span><span class="s">"$(OutputPath)\Sample.MyFancyPackageAnalyzer.dll"</span> <span class="na">PackagePath=</span><span class="s">"analyzers/dotnet/cs"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/ItemGroup&gt;</span>
  <span class="nt">&lt;/Target&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;None</span> <span class="na">Update=</span><span class="s">"tools\*.ps1"</span> <span class="na">CopyToOutputDirectory=</span><span class="s">"Always"</span> <span class="na">Pack=</span><span class="s">"true"</span> <span class="na">PackagePath=</span><span class="s">"tools"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>
<span class="nt">&lt;/Project&gt;</span>
</code></pre></div></div>

<p>Na záver vytvoríme NuGet balíček pomocou <code class="highlighter-rouge">dotnet publish</code>. Takto vytvorený balíček obsahuje ako vašu knižnicu tak aj analyzér, ktorý sa po nainštalovaní tohto balíčku automatický pridá medzi analyzéri v projekte.</p>

<h2 id="odkazy">Odkazy</h2>

<ul>
  <li><a href="https://www.youtube.com/watch?v=Rv90NaTxv0E">Zlepšite si svoj zdrojový kód pomocou Roslyn</a></li>
  <li><a href="https://devblogs.microsoft.com/dotnet/how-to-write-a-roslyn-analyzer/">How to write a Roslyn Analyzer</a></li>
</ul>

    </div>

    <div class="carousel">
        
    </div>

    <a class="u-url" href="/2020/11/04/distribuovanie-va%C5%A1ej-kni%C5%BEnice-spolu-s-roslyn-analyz%C3%A9rom" hidden></a>

</article>

            <script data-name="BMC-Widget" data-cfasync="false" 
                src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" 
                data-id="minomartiniak" 
                data-description="Support me on Buy me a coffee!" 
                data-message="" 
                data-color="#00BF63" data-position="Right" 
                data-x_margin="25" 
                data-y_margin="50">
            </script>
        </div>
    </main><footer class="footer">
  <span>
    &copy; <time datetime="2024-10-30 07:44:44 +0000">2024</time> Milan Martiniak
    <a rel="me" href="https://github.com/burgyn"
      title="GitHub - burgyn">
      <span class="fa fa-github" aria-label="GitHub"></span>
    </a>
    <a rel="me" href="https://twitter.com/minomartiniak"
      title="Twitter - minomartiniak">
      <span class="fa fa-twitter" aria-label="Twitter"></span>
    </a>
    <a rel="me" href="https://linkedin.com/in/milanmartiniak" title="LinkedIn - Milan Martiniak">
      <span class="fa fa-linkedin" aria-label="LinkedIn"></span>
    </a>

    <a rel="me" href="https://blog.burgyn.online/feed.xml" title="RSS feed">
      <span class="fa fa-rss" aria-label="RSS"></span>
    </a>
  </span>
</footer><script type="text/javascript">
        $(document).ready(function () {
            $('.carousel').slick({
                dots: true,
                infinite: true,
                speed: 300,
                slidesToShow: 1,
                centerMode: false,
                focusOnSelect: true,
                infinite: false,
                adaptiveHeight: true
            });
        });

        lightbox.option({
            'resizeDuration': 50,
            'wrapAround': false,
            'fadeDuration': 50,
            'imageFadeDuration': 50,
            'resizeDuration': 50            
        })

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>

</html>