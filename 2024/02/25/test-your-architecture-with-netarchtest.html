<!DOCTYPE html>
<html lang="en" class="colors theme-dark-2 entities fonts code-style"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark">

    <!-- cache -->
    <meta http-equiv="Cache-Control" content="max-age=86400, must-revalidate" />    

    <!-- Pridanie Slick Carousel CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" />
    <!-- Pridanie Slick Carousel Theme CSS (voliteľné) -->
    <link rel="stylesheet" type="text/css"
        href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css" />
    <!-- Pridanie jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Pridanie Lightbox CSS a JS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox-plus-jquery.min.js"></script>
    <!-- Pridanie Slick Carousel JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css">

    <!-- IMPORTANT -->
    <script src="https://use.fontawesome.com/ee196462b9.js"></script>

    <!-- keywoards -->
    
    <meta name="keywords" content="NetArchTest .NET, .NET architecture testing, Unit testing for software architecture, Validate .NET project architecture, .NET architectural rules validation, Ensuring architecture integrity in .NET, Custom architecture validation rules .NET, NetArchTest examples, Code quality improvement .NET, Continuous integration architecture tests, Software design principles testing .NET">
    

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FYN9BGS01R"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-FYN9BGS01R');
    </script>

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Test your architecture with NetArchTest | Burgyn’s blog</title>
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="Test your architecture with NetArchTest" />
<meta name="author" content="Milan Martiniak" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Discover how NetArchTest enhances architectural compliance in .NET projects. Learn to create unit tests for architecture integrity." />
<meta property="og:description" content="Discover how NetArchTest enhances architectural compliance in .NET projects. Learn to create unit tests for architecture integrity." />
<link rel="canonical" href="https://blog.burgyn.online/2024/02/25/test-your-architecture-with-netarchtest" />
<meta property="og:url" content="https://blog.burgyn.online/2024/02/25/test-your-architecture-with-netarchtest" />
<meta property="og:site_name" content="Burgyn’s blog" />
<meta property="og:image" content="https://blog.burgyn.online/assets/images/blog-post-base-cover.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-02-25T17:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://blog.burgyn.online/assets/images/blog-post-base-cover.png" />
<meta property="twitter:title" content="Test your architecture with NetArchTest" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Milan Martiniak","url":"https://burgyn.bio.link/"},"dateModified":"2024-02-25T17:00:00+00:00","datePublished":"2024-02-25T17:00:00+00:00","description":"Discover how NetArchTest enhances architectural compliance in .NET projects. Learn to create unit tests for architecture integrity.","headline":"Test your architecture with NetArchTest","image":"https://blog.burgyn.online/assets/images/blog-post-base-cover.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.burgyn.online/2024/02/25/test-your-architecture-with-netarchtest"},"url":"https://blog.burgyn.online/2024/02/25/test-your-architecture-with-netarchtest"}</script>
<!-- End Jekyll SEO tag -->


    


    <!-- CSS -->
    <link rel="stylesheet" href="/assets/main.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/assets/android-chrome-512x512.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/android-chrome-192x192.png">
    <link rel="android-chrome-192x192" type="image/png" sizes="192x192" href="/assets/android-chrome-192x192.png">
    <link rel="android-chrome-512x512" type="image/png" sizes="512x512" href="/assets/android-chrome-512x512.png">

    <!-- PWA -->
    <link rel="manifest" href="/assets/manifest.json">

    <!-- RSS -->
    <link type="application/atom+xml" rel="alternate" href="https://blog.burgyn.online/feed.xml" title="Burgyn's blog" />

    <!-- Google Analytics-->
    
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'dark'
        });
    </script>
</head><body>
    <svg width="0" height="0">
        <defs>
            <marker id="custom-arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
            <path d="M0,0 L0,7 L10,3.5 z"></path>
            </marker>
        </defs>
    </svg>
    <nav class="nav">
  <div class="nav-container">
    <a href="/">
      <div class="site-name">
        <img src="/assets/android-chrome-192x192.png" alt="Burgyn's logo" class="nav-logo">
        <h2 class="nav-title">Burgyn's blog</h2>
      </div>
    </a>    
    <ul>
      <li><a href="/">Posts</a></li>
      <li><a href="/about/">About me</a></li>
    </ul>
  </div>
</nav>

    <main class="page-content" aria-label="Content">
        <div class="wrapper">
            <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <header class="post-header">
        <h1 class="post-title p-name" itemprop="name headline"><p>Test your architecture with NetArchTest</p>
</h1>
        <p class="post-meta">
            <time class="dt-published" datetime="2024-02-25T17:00:00+00:00" itemprop="datePublished">Feb 25, 2024
            </time><span itemprop="author" itemscope
                itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name"> | Milan Martiniak</span></span>
            | <span class="fa fa-tags" aria-label="Tags"> </span> 
            <span>
                <!-- <a href="/tags/dotnet">dotnet</a> -->
                dotnet, 
            </span> 
            <span>
                <!-- <a href="/tags/unit tests">unit tests</a> -->
                unit tests, 
            </span> 
            <span>
                <!-- <a href="/tags/architecture">architecture</a> -->
                architecture, 
            </span> 
            <span>
                <!-- <a href="/tags/csharp">csharp</a> -->
                csharp
            </span>  
        </p>
    </header>

    

    <div class="post-content e-content" itemprop="articleBody">
        <p>Do you have an architecture type defined on the project? Onion / Clean / Vertical Slice / … architecture? 
Or do you have your own architecture rules? 
How do you verify that they are followed?</p>

<p>We have <code class="highlighter-rouge">.editorconfig</code>, <a href="https://github.com/dotnet/roslynator">Roslynator</a>, <a href="https://www.sonarsource.com/">SonarCloud</a>, … But this is not enough for architecture.</p>

<p>A solution may be to use the <a href="https://github.com/BenMorris/NetArchTest">NetArchTest</a> library. 
This library allows you to define different rules for the architecture and then continuously validate them using unit tests.</p>

<p>What are the rules? Preferably with examples:</p>

<ul>
  <li>the domain layer must not contain dependencies on other layers</li>
  <li>access to the database can only be in the infrastructure layer</li>
  <li>value objects must be immutable</li>
  <li>repositories must have the <code class="highlighter-rouge">Repository</code> suffix</li>
  <li>DTO classes must not be used in the domain and infrastructure layers</li>
  <li><code class="highlighter-rouge">async</code> methods must not have a return type of <code class="highlighter-rouge">void</code> and suffix <code class="highlighter-rouge">Async</code></li>
  <li>and many other rules that may be important on your project</li>
</ul>

<p>How to do it?</p>

<ul>
  <li>Add a reference to the <code class="highlighter-rouge">NetArchTest</code> library to the test project.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dotnet add package NetArchTest.Rules
</code></pre></div></div>

<ul>
  <li>We will create unit tests to verify our rules.</li>
</ul>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">RepositoriesShouldBeLocatedInInfrastructureNamespace</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">Types</span><span class="p">.</span><span class="nf">InAssembly</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ProductRepository</span><span class="p">).</span><span class="n">Assembly</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">That</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">ImplementInterface</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">IRepository</span><span class="p">))</span> <span class="c1">// 👈 rule for repositories</span>
        <span class="p">.</span><span class="nf">Should</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">ResideInNamespaceEndingWith</span><span class="p">(</span><span class="s">"Infrastructure"</span><span class="p">)</span> <span class="c1">// 👈 use rule</span>
        <span class="p">.</span><span class="nf">GetResult</span><span class="p">();</span>

    <span class="n">result</span><span class="p">.</span><span class="n">IsSuccessful</span><span class="p">.</span><span class="nf">Should</span><span class="p">().</span><span class="nf">BeTrue</span><span class="p">();</span>
<span class="p">}</span>

<span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">DomainShouldNotReferenceInfrastructure</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">Types</span><span class="p">.</span><span class="nf">InAssembly</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ProductDto</span><span class="p">).</span><span class="n">Assembly</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">That</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">ResideInNamespace</span><span class="p">(</span><span class="s">"EShop.Domains"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">ShouldNot</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">HaveDependencyOn</span><span class="p">(</span><span class="s">"EShop.Infrastructure"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">GetResult</span><span class="p">();</span>

    <span class="n">result</span><span class="p">.</span><span class="n">IsSuccessful</span><span class="p">.</span><span class="nf">Should</span><span class="p">().</span><span class="nf">BeTrue</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>We can also create our own rules.</li>
</ul>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">IsRecordRule</span> <span class="p">:</span> <span class="n">ICustomRule</span>
<span class="p">{</span>
    <span class="c1">// 👇 use custom rule for checking if type is Record</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">MeetsRule</span><span class="p">(</span><span class="n">TypeDefinition</span> <span class="n">type</span><span class="p">)</span>
        <span class="p">=&gt;</span> <span class="n">type</span><span class="p">.</span><span class="nf">GetMethods</span><span class="p">().</span><span class="nf">Any</span><span class="p">(</span><span class="n">m</span> <span class="p">=&gt;</span> <span class="n">m</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">"&lt;Clone&gt;$"</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">CustomRules</span>
<span class="p">{</span>
    <span class="c1">// 👇 extension method to simplify the use of a custom rule</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">ConditionList</span> <span class="nf">BeRecord</span><span class="p">(</span><span class="k">this</span> <span class="n">Conditions</span> <span class="n">conditions</span><span class="p">)</span>
        <span class="p">=&gt;</span> <span class="n">conditions</span><span class="p">.</span><span class="nf">MeetCustomRule</span><span class="p">(</span><span class="k">new</span> <span class="nf">IsRecordRule</span><span class="p">());</span>
<span class="p">}</span>

<span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">DtoShouldBeRecordType</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">Types</span><span class="p">.</span><span class="nf">InAssembly</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ProductDto</span><span class="p">).</span><span class="n">Assembly</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">That</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">HaveNameEndingWith</span><span class="p">(</span><span class="s">"Dto"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">Should</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">BeRecord</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">GetResult</span><span class="p">();</span>

    <span class="n">result</span><span class="p">.</span><span class="n">IsSuccessful</span><span class="p">.</span><span class="nf">Should</span><span class="p">().</span><span class="nf">BeTrue</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p><a href="https://github.com/Burgyn/Sample.NetArchTest">Whole demo</a>
<a href="https://github.com/BenMorris/NetArchTest">Documentation</a></p>

    </div>

    <div class="carousel">
        
    </div>

    <a class="u-url" href="/2024/02/25/test-your-architecture-with-netarchtest" hidden></a>

</article>

            <script data-name="BMC-Widget" data-cfasync="false" 
                src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" 
                data-id="minomartiniak" 
                data-description="Support me on Buy me a coffee!" 
                data-message="" 
                data-color="#00BF63" data-position="Right" 
                data-x_margin="25" 
                data-y_margin="50">
            </script>
        </div>
    </main><footer class="footer">
  <span>
    &copy; <time datetime="2024-10-30 07:44:44 +0000">2024</time> Milan Martiniak
    <a rel="me" href="https://github.com/burgyn"
      title="GitHub - burgyn">
      <span class="fa fa-github" aria-label="GitHub"></span>
    </a>
    <a rel="me" href="https://twitter.com/minomartiniak"
      title="Twitter - minomartiniak">
      <span class="fa fa-twitter" aria-label="Twitter"></span>
    </a>
    <a rel="me" href="https://linkedin.com/in/milanmartiniak" title="LinkedIn - Milan Martiniak">
      <span class="fa fa-linkedin" aria-label="LinkedIn"></span>
    </a>

    <a rel="me" href="https://blog.burgyn.online/feed.xml" title="RSS feed">
      <span class="fa fa-rss" aria-label="RSS"></span>
    </a>
  </span>
</footer><script type="text/javascript">
        $(document).ready(function () {
            $('.carousel').slick({
                dots: true,
                infinite: true,
                speed: 300,
                slidesToShow: 1,
                centerMode: false,
                focusOnSelect: true,
                infinite: false,
                adaptiveHeight: true
            });
        });

        lightbox.option({
            'resizeDuration': 50,
            'wrapAround': false,
            'fadeDuration': 50,
            'imageFadeDuration': 50,
            'resizeDuration': 50            
        })

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>

</html>