<!DOCTYPE html>
<html lang="en" class="colors theme-dark-2 entities fonts code-style"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark">

    <!-- cache -->
    <meta http-equiv="Cache-Control" content="max-age=86400, must-revalidate" />    

    <!-- Pridanie Slick Carousel CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" />
    <!-- Pridanie Slick Carousel Theme CSS (voliteľné) -->
    <link rel="stylesheet" type="text/css"
        href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css" />
    <!-- Pridanie jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Pridanie Lightbox CSS a JS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox-plus-jquery.min.js"></script>
    <!-- Pridanie Slick Carousel JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css">

    <!-- IMPORTANT -->
    <script src="https://use.fontawesome.com/ee196462b9.js"></script>

    <!-- keywoards -->
    
    <meta name="keywords" content="ASP.NET Core, HttpContext.Request.Features, Dependency Injection, Middleware, Request Lifecycle, IFeatureCollection, ICurrentTenantInfo, HttpContext.Items">
    

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FYN9BGS01R"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-FYN9BGS01R');
    </script>

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>HttpContext Request Features | Burgyn’s blog</title>
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="HttpContext Request Features" />
<meta name="author" content="Milan Martiniak" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Learn how to use HttpContext.Request.Features in ASP.NET Core to store and retrieve information related to individual requests." />
<meta property="og:description" content="Learn how to use HttpContext.Request.Features in ASP.NET Core to store and retrieve information related to individual requests." />
<link rel="canonical" href="https://blog.burgyn.online/2024/04/21/httpcontext-request-features" />
<meta property="og:url" content="https://blog.burgyn.online/2024/04/21/httpcontext-request-features" />
<meta property="og:site_name" content="Burgyn’s blog" />
<meta property="og:image" content="https://blog.burgyn.online/assets/images/code_images/httpcontext-request-features/cover.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-04-21T17:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://blog.burgyn.online/assets/images/code_images/httpcontext-request-features/cover.png" />
<meta property="twitter:title" content="HttpContext Request Features" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Milan Martiniak","url":"https://burgyn.bio.link/"},"dateModified":"2024-04-21T17:00:00+00:00","datePublished":"2024-04-21T17:00:00+00:00","description":"Learn how to use HttpContext.Request.Features in ASP.NET Core to store and retrieve information related to individual requests.","headline":"HttpContext Request Features","image":"https://blog.burgyn.online/assets/images/code_images/httpcontext-request-features/cover.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.burgyn.online/2024/04/21/httpcontext-request-features"},"url":"https://blog.burgyn.online/2024/04/21/httpcontext-request-features"}</script>
<!-- End Jekyll SEO tag -->


    


    <!-- CSS -->
    <link rel="stylesheet" href="/assets/main.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/assets/android-chrome-512x512.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/android-chrome-192x192.png">
    <link rel="android-chrome-192x192" type="image/png" sizes="192x192" href="/assets/android-chrome-192x192.png">
    <link rel="android-chrome-512x512" type="image/png" sizes="512x512" href="/assets/android-chrome-512x512.png">

    <!-- PWA -->
    <link rel="manifest" href="/assets/manifest.json">

    <!-- RSS -->
    <link type="application/atom+xml" rel="alternate" href="https://blog.burgyn.online/feed.xml" title="Burgyn's blog" />

    <!-- Google Analytics-->
    
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'dark'
        });
    </script>
</head><body>
    <svg width="0" height="0">
        <defs>
            <marker id="custom-arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
            <path d="M0,0 L0,7 L10,3.5 z"></path>
            </marker>
        </defs>
    </svg>
    <nav class="nav">
  <div class="nav-container">
    <a href="/">
      <div class="site-name">
        <img src="/assets/android-chrome-192x192.png" alt="Burgyn's logo" class="nav-logo">
        <h2 class="nav-title">Burgyn's blog</h2>
      </div>
    </a>    
    <ul>
      <li><a href="/">Posts</a></li>
      <li><a href="/about/">About me</a></li>
    </ul>
  </div>
</nav>

    <main class="page-content" aria-label="Content">
        <div class="wrapper">
            <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <header class="post-header">
        <h1 class="post-title p-name" itemprop="name headline"><p>HttpContext Request Features</p>
</h1>
        <p class="post-meta">
            <time class="dt-published" datetime="2024-04-21T17:00:00+00:00" itemprop="datePublished">Apr 21, 2024
            </time><span itemprop="author" itemscope
                itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name"> | Milan Martiniak</span></span>
            | <span class="fa fa-tags" aria-label="Tags"> </span> 
            <span>
                <!-- <a href="/tags/csharp">csharp</a> -->
                csharp, 
            </span> 
            <span>
                <!-- <a href="/tags/asp.net core">asp.net core</a> -->
                asp.net core, 
            </span> 
            <span>
                <!-- <a href="/tags/multi-tenant">multi-tenant</a> -->
                multi-tenant, 
            </span> 
            <span>
                <!-- <a href="/tags/architecture">architecture</a> -->
                architecture
            </span>  
        </p>
    </header>

    
    <div class="post-thumbnail">
        <img src="/assets/images/code_images/httpcontext-request-features/cover.png" alt="HttpContext Request Features" itemprop="image">
    </div>
    

    <div class="post-content e-content" itemprop="articleBody">
        <p>In ASP.NET Core, we are used to working with dependency injection and we tend to pass most of the information through dependency injection to the classes where we need it. 
However, sometimes we work with information that is closely tied to a particular request and we don’t need, want, or can’t inject it into classes as dependencies. 
For such cases, there is <code class="highlighter-rouge">HttpContext.Features</code>.</p>

<p>The <code class="highlighter-rouge">Features</code> property is a simple collection of type <code class="highlighter-rouge">IFeatureCollection</code>, where we can store strongly typed objects and then retrieve them at places where we need them. 
This collection is available within <code class="highlighter-rouge">HttpContext</code> and is available throughout the request lifecycle. 
The <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/use-http-context?view=aspnetcore-8.0#features">ASP.NET Core framework </a>itself uses this collection to store various information, for example:</p>
<ul>
  <li><code class="highlighter-rouge">IRouteValuesFeature</code> - contains information about the parameters and their values from the request path</li>
  <li><code class="highlighter-rouge">IEndpointFeature</code> - contains information about the endpoint that processes the request</li>
  <li>…</li>
</ul>

<p>The <code class="highlighter-rouge">Features</code> property is also available to us and we can store our own information that we will need during the request processing.
An example use case might be storing information about the current user, the current tenant, or other information that is necessary 
for processing the request with is bound in some way, or retrieved from the request itself.</p>

<p>Information is typically stored in <code class="highlighter-rouge">Features</code> within middleware that is registered within the application pipeline. 
The middleware can retrieve the information from the request, process it, and then store it in <code class="highlighter-rouge">Features</code> for further processing within the application.</p>

<p>An example of middleware that retrieves information about the current tenant from a request and stores it in <code class="highlighter-rouge">Features</code> might look like the following:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">CurrentTenantInfoMiddleware</span><span class="p">(</span><span class="n">RequestDelegate</span> <span class="n">next</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">RequestDelegate</span> <span class="n">_next</span> <span class="p">=</span> <span class="n">next</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">InvokeAsync</span><span class="p">(</span><span class="n">HttpContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">ITenantService</span> <span class="n">tenantService</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 👇 More complex logic to determine the current tenant can be added here</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">Headers</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="s">"X-TenantId"</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">routeValue</span><span class="p">)</span>
            <span class="p">&amp;&amp;</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">TryParse</span><span class="p">(</span><span class="n">routeValue</span><span class="p">.</span><span class="nf">First</span><span class="p">()?.</span><span class="nf">ToString</span><span class="p">(),</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">tenantId</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">tenantInfo</span> <span class="p">=</span> <span class="k">await</span> <span class="n">tenantService</span><span class="p">.</span><span class="nf">GetTenantInfoAsync</span><span class="p">(</span><span class="n">tenantId</span><span class="p">);</span>
            <span class="c1">// 👇 Store the tenant info in Features</span>
            <span class="n">context</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="n">tenantInfo</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">await</span> <span class="nf">_next</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 👇 Register the middleware</span>
<span class="n">app</span><span class="p">.</span><span class="n">UseMiddleware</span><span class="p">&lt;</span><span class="n">CurrentTenantInfoMiddleware</span><span class="p">&gt;();</span>
</code></pre></div></div>

<p>We can then access information about the current tenant from <code class="highlighter-rouge">Features</code> within other parts of the application:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="nf">MapGet</span><span class="p">(</span><span class="s">"/api/"</span><span class="p">,</span> <span class="p">(</span><span class="n">HttpContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="c1">// 👇 Access the current tenant info from the context</span>
    <span class="kt">var</span> <span class="n">currentTenantInfo</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">Get</span><span class="p">&lt;</span><span class="n">ICurrentTenantInfo</span><span class="p">&gt;();</span>
    <span class="k">return</span> <span class="n">Results</span><span class="p">.</span><span class="nf">Ok</span><span class="p">(</span><span class="n">currentTenantInfo</span><span class="p">?.</span><span class="n">Id</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>For simplicity, we can create an extension method for <code class="highlighter-rouge">IFeatureCollection</code>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">IFeatureCollectionExtensions</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">ICurrentTenantInfo</span><span class="p">?</span> <span class="nf">GetTenant</span><span class="p">(</span><span class="k">this</span> <span class="n">IFeatureCollection</span> <span class="n">features</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">features</span><span class="p">.</span><span class="n">Get</span><span class="p">&lt;</span><span class="n">ICurrentTenantInfo</span><span class="p">&gt;();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">var</span> <span class="n">tenantInfo</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="nf">GetTenant</span><span class="p">();</span>
</code></pre></div></div>

<blockquote>
  <p>For completeness: another way to transfer information during one request is to use <code class="highlighter-rouge">HttpContext.Items</code>. This collection is available within <code class="highlighter-rouge">HttpContext</code> and is available throughout the request lifecycle. However, <code class="highlighter-rouge">Items</code> is not strongly typed. It is a key value. Therefore, it is preferable to use <code class="highlighter-rouge">Features</code> if we need to store strongly typed objects.</p>
</blockquote>

    </div>

    <div class="carousel">
        
    </div>

    <a class="u-url" href="/2024/04/21/httpcontext-request-features" hidden></a>

</article>

            <script data-name="BMC-Widget" data-cfasync="false" 
                src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" 
                data-id="minomartiniak" 
                data-description="Support me on Buy me a coffee!" 
                data-message="" 
                data-color="#00BF63" data-position="Right" 
                data-x_margin="25" 
                data-y_margin="50">
            </script>
        </div>
    </main><footer class="footer">
  <span>
    &copy; <time datetime="2025-02-19 05:37:39 +0000">2025</time> Milan Martiniak
    <a rel="me" href="https://github.com/burgyn"
      title="GitHub - burgyn">
      <span class="fa fa-github" aria-label="GitHub"></span>
    </a>
    <a rel="me" href="https://twitter.com/minomartiniak"
      title="Twitter - minomartiniak">
      <span class="fa fa-twitter" aria-label="Twitter"></span>
    </a>
    <a rel="me" href="https://linkedin.com/in/milanmartiniak" title="LinkedIn - Milan Martiniak">
      <span class="fa fa-linkedin" aria-label="LinkedIn"></span>
    </a>

    <a rel="me" href="https://blog.burgyn.online/feed.xml" title="RSS feed">
      <span class="fa fa-rss" aria-label="RSS"></span>
    </a>
  </span>
</footer><script type="text/javascript">
        $(document).ready(function () {
            $('.carousel').slick({
                dots: true,
                infinite: true,
                speed: 300,
                slidesToShow: 1,
                centerMode: false,
                focusOnSelect: true,
                infinite: false,
                adaptiveHeight: true
            });
        });

        lightbox.option({
            'resizeDuration': 50,
            'wrapAround': false,
            'fadeDuration': 50,
            'imageFadeDuration': 50,
            'resizeDuration': 50            
        })

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>

</html>