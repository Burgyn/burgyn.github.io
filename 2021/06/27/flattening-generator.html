<!DOCTYPE html>
<html lang="en" class="colors theme-dark-2 entities fonts code-style"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark">

    <!-- cache -->
    <meta http-equiv="Cache-Control" content="max-age=86400, must-revalidate" />    

    <!-- Pridanie Slick Carousel CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" />
    <!-- Pridanie Slick Carousel Theme CSS (voliteľné) -->
    <link rel="stylesheet" type="text/css"
        href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css" />
    <!-- Pridanie jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Pridanie Lightbox CSS a JS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox-plus-jquery.min.js"></script>
    <!-- Pridanie Slick Carousel JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css">

    <!-- IMPORTANT -->
    <script src="https://use.fontawesome.com/ee196462b9.js"></script>

    <!-- keywoards -->
    

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FYN9BGS01R"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-FYN9BGS01R');
    </script>

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Flattening generator | Burgyn’s blog</title>
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="Flattening generator" />
<meta name="author" content="Milan Martiniak" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Sometimes your data source contains a flattened version of your complex domain classes. For example, the class Person contains the Address property and it contains the Town property. But your data source contains AddressTown column. If you needed an internal class to process such source data, you had to write it manually. You can now use the Flattening generator for this." />
<meta property="og:description" content="Sometimes your data source contains a flattened version of your complex domain classes. For example, the class Person contains the Address property and it contains the Town property. But your data source contains AddressTown column. If you needed an internal class to process such source data, you had to write it manually. You can now use the Flattening generator for this." />
<link rel="canonical" href="https://blog.burgyn.online/2021/06/27/flattening-generator" />
<meta property="og:url" content="https://blog.burgyn.online/2021/06/27/flattening-generator" />
<meta property="og:site_name" content="Burgyn’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-06-27T18:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Flattening generator" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Milan Martiniak","url":"https://burgyn.bio.link/"},"dateModified":"2021-06-27T18:00:00+00:00","datePublished":"2021-06-27T18:00:00+00:00","description":"Sometimes your data source contains a flattened version of your complex domain classes. For example, the class Person contains the Address property and it contains the Town property. But your data source contains AddressTown column. If you needed an internal class to process such source data, you had to write it manually. You can now use the Flattening generator for this.","headline":"Flattening generator","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.burgyn.online/2021/06/27/flattening-generator"},"url":"https://blog.burgyn.online/2021/06/27/flattening-generator"}</script>
<!-- End Jekyll SEO tag -->


    


    <!-- CSS -->
    <link rel="stylesheet" href="/assets/main.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/assets/android-chrome-512x512.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/android-chrome-192x192.png">
    <link rel="android-chrome-192x192" type="image/png" sizes="192x192" href="/assets/android-chrome-192x192.png">
    <link rel="android-chrome-512x512" type="image/png" sizes="512x512" href="/assets/android-chrome-512x512.png">

    <!-- PWA -->
    <link rel="manifest" href="/assets/manifest.json">

    <!-- RSS -->
    <link type="application/atom+xml" rel="alternate" href="https://blog.burgyn.online/feed.xml" title="Burgyn's blog" />

    <!-- Google Analytics-->
    
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'dark'
        });
    </script>
</head><body>
    <svg width="0" height="0">
        <defs>
            <marker id="custom-arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
            <path d="M0,0 L0,7 L10,3.5 z"></path>
            </marker>
        </defs>
    </svg>
    <nav class="nav">
  <div class="nav-container">
    <a href="/">
      <div class="site-name">
        <img src="/assets/android-chrome-192x192.png" alt="Burgyn's logo" class="nav-logo">
        <h2 class="nav-title">Burgyn's blog</h2>
      </div>
    </a>    
    <ul>
      <li><a href="/">Posts</a></li>
      <li><a href="/about/">About me</a></li>
    </ul>
  </div>
</nav>

    <main class="page-content" aria-label="Content">
        <div class="wrapper">
            <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <header class="post-header">
        <h1 class="post-title p-name" itemprop="name headline"><p>Flattening generator</p>
</h1>
        <p class="post-meta">
            <time class="dt-published" datetime="2021-06-27T18:00:00+00:00" itemprop="datePublished">Jun 27, 2021
            </time><span itemprop="author" itemscope
                itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name"> | Milan Martiniak</span></span>
            | <span class="fa fa-tags" aria-label="Tags"> </span> 
            <span>
                <!-- <a href="/tags/C#">C#</a> -->
                C#, 
            </span> 
            <span>
                <!-- <a href="/tags/Generators">Generators</a> -->
                Generators, 
            </span> 
            <span>
                <!-- <a href="/tags/Roslyn">Roslyn</a> -->
                Roslyn, 
            </span> 
            <span>
                <!-- <a href="/tags/.NET">.NET</a> -->
                .NET
            </span>  
        </p>
    </header>

    

    <div class="post-content e-content" itemprop="articleBody">
        <p>Sometimes your data source contains a flattened version of your complex domain classes. For example, the class <code class="highlighter-rouge">Person</code> contains the <code class="highlighter-rouge">Address</code> property and it contains the <code class="highlighter-rouge">Town</code> property. But your data source contains <code class="highlighter-rouge">AddressTown</code> column. If you needed an internal class to process such source data, you had to write it manually. You can now use the <a href="https://github.com/Kros-sk/Kros.Generators.Flattening">Flattening generator</a> for this.</p>

<h2 id="installation">Installation</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  dotnet add package Kros.Generators.Flattening
</code></pre></div></div>

<h2 id="how-to-use-it">How to use it</h2>

<p>You define partial class and marke it with the <code class="highlighter-rouge">Flatten</code> attribute.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nf">Flatten</span><span class="p">(</span><span class="n">SourceType</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Person</span><span class="p">))]</span>
<span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">PersonFlat</span>
<span class="p">{</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And that’s it. The generator will generate a partial class for you, which will contain all the necessary properties.</p>

<h2 id="another-example">Another example</h2>

<p>You have the following domain classes and value objects.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Document</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">Contact</span> <span class="n">Owner</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">Contact</span> <span class="n">Collaborator</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Contact</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">Address</span> <span class="n">Address</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Address</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">City</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Street</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And you want a flattened class, but with some exceptions.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nf">Flatten</span><span class="p">(</span><span class="n">SourceType</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Document</span><span class="p">))]</span>
<span class="p">[</span><span class="nf">FlattenPropertyName</span><span class="p">(</span><span class="n">SourcePropertyName</span> <span class="p">=</span> <span class="s">"Owner.Address.City"</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">"Town"</span><span class="p">)]</span>
<span class="p">[</span><span class="nf">FlattenPropertyName</span><span class="p">(</span><span class="n">SourcePropertyName</span> <span class="p">=</span> <span class="s">"Collaborator.Address"</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">""</span><span class="p">)]</span>
<span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">DocumentFlat</span>
<span class="p">{</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The generated class will look like this:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">DocumentFlat</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">OwnerName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="kt">string</span> <span class="n">OwnerAddressTown</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="kt">string</span> <span class="n">OwnerAddressStreet</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="kt">string</span> <span class="n">CollaboratorName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="kt">string</span> <span class="n">CollaboratorCity</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="kt">string</span> <span class="n">CollaboratorStreet</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="settings">Settings</h2>

<h3 id="skip">Skip</h3>

<p>You may not want to generate some properties into the output flattened class. To do this, you can use the <code class="highlighter-rouge">Skip</code> parameter and define a list of properties to be ignored.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nf">Flatten</span><span class="p">(</span><span class="n">SourceType</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Document</span><span class="p">),</span>
    <span class="n">Skip</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[]</span> <span class="p">{</span> <span class="k">nameof</span><span class="p">(</span><span class="n">Document</span><span class="p">.</span><span class="n">Collaborator</span><span class="p">)})]</span>
</code></pre></div></div>

<h3 id="donotflatten">DoNotFlatten</h3>

<p>If you do not want to flatten any of the properties, use the parameter to do so <code class="highlighter-rouge">DoNotFlatten</code>.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nf">Flatten</span><span class="p">(</span><span class="n">SourceType</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Document</span><span class="p">),</span>
    <span class="n">DoNotFlatten</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[]</span> <span class="p">{</span> <span class="k">nameof</span><span class="p">(</span><span class="n">Document</span><span class="p">.</span><span class="n">Owner</span><span class="p">)</span> <span class="p">})]</span>
</code></pre></div></div>

<h3 id="rename-outup-property">Rename outup property</h3>

<p>If you want to rename the output property, use the <code class="highlighter-rouge">FlattenPropertyName</code> attribute.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nf">FlattenPropertyName</span><span class="p">(</span><span class="n">SourcePropertyName</span> <span class="p">=</span> <span class="s">"Owner.Address.City"</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">"Town"</span><span class="p">)]</span>
<span class="p">[</span><span class="nf">FlattenPropertyName</span><span class="p">(</span><span class="n">SourcePropertyName</span> <span class="p">=</span> <span class="s">"Collaborator.Address"</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">""</span><span class="p">)]</span>
</code></pre></div></div>

<h2 id="mapping">Mapping</h2>

<p>This generator also generates <code class="highlighter-rouge">ToComplex</code> and <code class="highlighter-rouge">FromComplex</code> mapping methods for you.</p>

<h3 id="tocomplex">ToComplex</h3>

<p>Allows you to map a flat instance to its complex domain form.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DocumentFlat</span> <span class="n">flat</span> <span class="p">=</span> <span class="k">new</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">OwnerAddressTown</span> <span class="p">=</span> <span class="s">"Wichita, KS 67202"</span><span class="p">,</span>
    <span class="n">OwnerAddressStreet</span> <span class="p">=</span> <span class="s">"1938 Roosevelt Road"</span><span class="p">,</span>
    <span class="n">OwnerName</span> <span class="p">=</span> <span class="s">"Jill A. Spurgeon"</span><span class="p">,</span>
    <span class="n">CollaboratorCity</span> <span class="p">=</span> <span class="s">"8282 Koprivnica"</span><span class="p">,</span>
    <span class="n">CollaboratorStreet</span> <span class="p">=</span> <span class="s">"Kolodvorska 28"</span><span class="p">,</span>
    <span class="n">CollaboratorName</span> <span class="p">=</span> <span class="s">"Christine M. Dudley"</span><span class="p">,</span>
    <span class="n">Name</span> <span class="p">=</span> <span class="s">"new document"</span>
<span class="p">};</span>

<span class="n">Document</span> <span class="n">document</span> <span class="p">=</span> <span class="n">flat</span><span class="p">.</span><span class="nf">ToComplex</span><span class="p">();</span>
</code></pre></div></div>

<p>Or simply use the implicit conversion.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Document</span> <span class="n">document</span> <span class="p">=</span> <span class="n">flat</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="fromcomplex">FromComplex</h3>

<p>It allows you to create a flattened instance of your complex domain class.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DocumentFlat</span> <span class="n">flat</span> <span class="p">=</span> <span class="n">DocumentFlat</span><span class="p">.</span><span class="nf">FromComplex</span><span class="p">(</span><span class="n">document</span><span class="p">);</span>
</code></pre></div></div>

<p>Or simply use the explicit conversion.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DocumentFlat</span> <span class="n">flat</span> <span class="p">=</span> <span class="p">(</span><span class="n">DocumentFlat</span><span class="p">)</span><span class="n">document</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="ienumerabletocomplex">IEnumerable.ToComplex</h3>

<p>It is possible to convert an entire collection of flattened instances to a collection of complex objects.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">DocumentFlat</span><span class="p">&gt;</span> <span class="n">flatDocuments</span> <span class="p">=</span> <span class="nf">LoadData</span><span class="p">();</span>

<span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Document</span><span class="p">&gt;</span> <span class="n">documents</span> <span class="p">=</span> <span class="n">flatDocuments</span><span class="p">.</span><span class="n">ToComplex</span><span class="p">&lt;</span><span class="n">DocumentFlat</span><span class="p">,</span> <span class="n">Document</span><span class="p">&gt;();</span>
</code></pre></div></div>

<h2 id="limitation">Limitation</h2>

<p>⚠ Mapping methods are generated only if all types contain a public parameterless constructor or a constructor that has the same parameters as the properties (case insensitive).</p>

    </div>

    <div class="carousel">
        
    </div>

    <a class="u-url" href="/2021/06/27/flattening-generator" hidden></a>

</article>

            <script data-name="BMC-Widget" data-cfasync="false" 
                src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" 
                data-id="minomartiniak" 
                data-description="Support me on Buy me a coffee!" 
                data-message="" 
                data-color="#00BF63" data-position="Right" 
                data-x_margin="25" 
                data-y_margin="50">
            </script>
        </div>
    </main><footer class="footer">
  <span>
    &copy; <time datetime="2025-02-19 05:37:39 +0000">2025</time> Milan Martiniak
    <a rel="me" href="https://github.com/burgyn"
      title="GitHub - burgyn">
      <span class="fa fa-github" aria-label="GitHub"></span>
    </a>
    <a rel="me" href="https://twitter.com/minomartiniak"
      title="Twitter - minomartiniak">
      <span class="fa fa-twitter" aria-label="Twitter"></span>
    </a>
    <a rel="me" href="https://linkedin.com/in/milanmartiniak" title="LinkedIn - Milan Martiniak">
      <span class="fa fa-linkedin" aria-label="LinkedIn"></span>
    </a>

    <a rel="me" href="https://blog.burgyn.online/feed.xml" title="RSS feed">
      <span class="fa fa-rss" aria-label="RSS"></span>
    </a>
  </span>
</footer><script type="text/javascript">
        $(document).ready(function () {
            $('.carousel').slick({
                dots: true,
                infinite: true,
                speed: 300,
                slidesToShow: 1,
                centerMode: false,
                focusOnSelect: true,
                infinite: false,
                adaptiveHeight: true
            });
        });

        lightbox.option({
            'resizeDuration': 50,
            'wrapAround': false,
            'fadeDuration': 50,
            'imageFadeDuration': 50,
            'resizeDuration': 50            
        })

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>

</html>