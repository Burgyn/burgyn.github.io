<!DOCTYPE html>
<html lang="en" class="colors theme-dark-2 entities fonts code-style"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark">

    <!-- cache -->
    <meta http-equiv="Cache-Control" content="max-age=86400, must-revalidate" />    

    <!-- Pridanie Slick Carousel CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" />
    <!-- Pridanie Slick Carousel Theme CSS (voliteľné) -->
    <link rel="stylesheet" type="text/css"
        href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css" />
    <!-- Pridanie jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Pridanie Lightbox CSS a JS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox-plus-jquery.min.js"></script>
    <!-- Pridanie Slick Carousel JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css">

    <!-- IMPORTANT -->
    <script src="https://use.fontawesome.com/ee196462b9.js"></script>

    <!-- keywoards -->
    

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FYN9BGS01R"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-FYN9BGS01R');
    </script>

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Swagger documentation of Ocelot aggregates | Burgyn’s blog</title>
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="Swagger documentation of Ocelot aggregates" />
<meta name="author" content="Milan Martiniak" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I wrote in the article Swagger for Ocelot API Gateway about how to use the MMLib.SwaggerForOcelot package to document your system directly through the Ocelot gateway. In this article, I want to look at its relatively new functionality, namely the ability to create and generate documentation for Ocelot aggregations." />
<meta property="og:description" content="I wrote in the article Swagger for Ocelot API Gateway about how to use the MMLib.SwaggerForOcelot package to document your system directly through the Ocelot gateway. In this article, I want to look at its relatively new functionality, namely the ability to create and generate documentation for Ocelot aggregations." />
<link rel="canonical" href="https://blog.burgyn.online/2021/02/04/swagger-documentation-of-ocelot-aggregates" />
<meta property="og:url" content="https://blog.burgyn.online/2021/02/04/swagger-documentation-of-ocelot-aggregates" />
<meta property="og:site_name" content="Burgyn’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-02-04T18:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Swagger documentation of Ocelot aggregates" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Milan Martiniak","url":"https://burgyn.bio.link/"},"dateModified":"2021-02-04T18:00:00+00:00","datePublished":"2021-02-04T18:00:00+00:00","description":"I wrote in the article Swagger for Ocelot API Gateway about how to use the MMLib.SwaggerForOcelot package to document your system directly through the Ocelot gateway. In this article, I want to look at its relatively new functionality, namely the ability to create and generate documentation for Ocelot aggregations.","headline":"Swagger documentation of Ocelot aggregates","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.burgyn.online/2021/02/04/swagger-documentation-of-ocelot-aggregates"},"url":"https://blog.burgyn.online/2021/02/04/swagger-documentation-of-ocelot-aggregates"}</script>
<!-- End Jekyll SEO tag -->


    


    <!-- CSS -->
    <link rel="stylesheet" href="/assets/main.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/assets/android-chrome-512x512.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/android-chrome-192x192.png">
    <link rel="android-chrome-192x192" type="image/png" sizes="192x192" href="/assets/android-chrome-192x192.png">
    <link rel="android-chrome-512x512" type="image/png" sizes="512x512" href="/assets/android-chrome-512x512.png">

    <!-- PWA -->
    <link rel="manifest" href="/assets/manifest.json">

    <!-- RSS -->
    <link type="application/atom+xml" rel="alternate" href="https://blog.burgyn.online/feed.xml" title="Burgyn's blog" />

    <!-- Google Analytics-->
    
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'dark'
        });
    </script>
</head><body>
    <svg width="0" height="0">
        <defs>
            <marker id="custom-arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
            <path d="M0,0 L0,7 L10,3.5 z"></path>
            </marker>
        </defs>
    </svg>
    <nav class="nav">
  <div class="nav-container">
    <a href="/">
      <div class="site-name">
        <img src="/assets/android-chrome-192x192.png" alt="Burgyn's logo" class="nav-logo">
        <h2 class="nav-title">Burgyn's blog</h2>
      </div>
    </a>    
    <ul>
      <li><a href="/">Posts</a></li>
      <li><a href="/about/">About me</a></li>
    </ul>
  </div>
</nav>

    <main class="page-content" aria-label="Content">
        <div class="wrapper">
            <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <header class="post-header">
        <h1 class="post-title p-name" itemprop="name headline"><p>Swagger documentation of Ocelot aggregates</p>
</h1>
        <p class="post-meta">
            <time class="dt-published" datetime="2021-02-04T18:00:00+00:00" itemprop="datePublished">Feb 4, 2021
            </time><span itemprop="author" itemscope
                itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name"> | Milan Martiniak</span></span>
            | <span class="fa fa-tags" aria-label="Tags"> </span> 
            <span>
                <!-- <a href="/tags/microservices">microservices</a> -->
                microservices, 
            </span> 
            <span>
                <!-- <a href="/tags/C#">C#</a> -->
                C#, 
            </span> 
            <span>
                <!-- <a href="/tags/.NET Core">.NET Core</a> -->
                .NET Core, 
            </span> 
            <span>
                <!-- <a href="/tags/ASP.NET Core">ASP.NET Core</a> -->
                ASP.NET Core
            </span>  
        </p>
    </header>

    

    <div class="post-content e-content" itemprop="articleBody">
        <p>I wrote in the article <a href="https://blog.burgyn.online/2020/04/17/swagger-for-ocelot-api-gateway-en">Swagger for Ocelot API Gateway</a> about how to use the <code class="highlighter-rouge">MMLib.SwaggerForOcelot</code> package to document your system directly through the Ocelot gateway.
In this article, I want to look at its relatively new functionality, namely the ability to create and generate documentation for Ocelot aggregations.</p>

<hr />

<p>You are probably familiar with Ocelot great feature <a href="https://ocelot.readthedocs.io/en/latest/features/requestaggregation.html"><strong><em>Request Aggregation</em></strong></a>. Request Aggregation allows you to easily add a new endpoint to the gateway that will aggregate the result from other existing endpoints.
If you use these aggregations, you would probably want to have these endpoints in the api documentation as well.</p>

<p>In <code class="highlighter-rouge">ConfigureServices</code> allow <code class="highlighter-rouge">GenerateDocsForAggregates</code> option.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">services</span><span class="p">.</span><span class="nf">AddSwaggerForOcelot</span><span class="p">(</span><span class="n">Configuration</span><span class="p">,</span>
  <span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="p">=&gt;</span>
  <span class="p">{</span>
      <span class="n">o</span><span class="p">.</span><span class="n">GenerateDocsForAggregates</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
  <span class="p">});</span>
</code></pre></div></div>

<p>Documentations of your aggregates will be available on custom page <strong>Aggregates</strong>.
<img src="https://raw.githubusercontent.com/Burgyn/MMLib.SwaggerForOcelot/master/demo/aggregates.png" alt="aggregates docs" /></p>

<h3 id="custom-description">Custom description</h3>

<p>By default, this package generate description from downstream documentation. If you want add custom description for your aggregate route, you can add description to <code class="highlighter-rouge">ocelot.json</code>.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"Aggregates"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> 
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"RouteKeys"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"basket"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"Description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Custom description for this aggregate route."</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Aggregator"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BasketAggregator"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UpstreamPathTemplate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/gateway/api/basketwithuser/{id}"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<h3 id="different-parameter-names">Different parameter names</h3>

<p>It is likely that you will have different parameter names in the downstream services that you are aggregating. For example, in the User service you will have the <code class="highlighter-rouge">{Id}</code> parameter, but in the Basket service the same parameter will be called <code class="highlighter-rouge">{BuyerId}</code>. In order for Ocelot aggregations to work, you must have parameters named the same in Ocelot configurations, but this will make it impossible to find the correct documentation.</p>

<p>Therefore, you can help the configuration by setting parameter name map.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"DownstreamPathTemplate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/api/basket/{id}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"UpstreamPathTemplate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/gateway/api/basket/{id}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"ParametersMap"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"buyerId"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"ServiceName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"basket"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"SwaggerKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"basket"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"basket"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Property <code class="highlighter-rouge">ParametersMap</code> is map, where <code class="highlighter-rouge">key</code> <em>(first parameter)</em> is the name of parameter in Ocelot configuration and <code class="highlighter-rouge">value</code> <em>(second parameter)</em> is the name of parameter in downstream service.</p>

<h3 id="custom-aggregator">Custom aggregator</h3>

<p>The response documentation is generated according to the rules that Ocelot uses to compose the response from the aggregate. If you use your custom <code class="highlighter-rouge">IDefinedAggregator</code>, your result may be different. In this case you can use <code class="highlighter-rouge">AggregateResponseAttibute</code>.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nf">AggregateResponse</span><span class="p">(</span><span class="s">"Basket with buyer and busket items."</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">CustomResponse</span><span class="p">))]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">BasketAggregator</span> <span class="p">:</span> <span class="n">IDefinedAggregator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">DownstreamResponse</span><span class="p">&gt;</span> <span class="nf">Aggregate</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">HttpContext</span><span class="p">&gt;</span> <span class="n">responses</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="modifying-the-generated-documentation">Modifying the generated documentation</h3>

<p>If you do not like the final documentation, you can modify it by defining your custom postprocessor.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">services</span><span class="p">.</span><span class="nf">AddSwaggerForOcelot</span><span class="p">(</span><span class="n">Configuration</span><span class="p">,</span>
  <span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="p">=&gt;</span>
  <span class="p">{</span>
      <span class="n">o</span><span class="p">.</span><span class="n">GenerateDocsForAggregates</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
      <span class="n">o</span><span class="p">.</span><span class="n">AggregateDocsGeneratorPostProcess</span> <span class="p">=</span> <span class="p">(</span><span class="n">aggregateRoute</span><span class="p">,</span> <span class="n">routesDocs</span><span class="p">,</span> <span class="n">pathItemDoc</span><span class="p">,</span> <span class="n">documentation</span><span class="p">)</span> <span class="p">=&gt;</span>
      <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">aggregateRoute</span><span class="p">.</span><span class="n">UpstreamPathTemplate</span> <span class="p">==</span> <span class="s">"/gateway/api/basketwithuser/{id}"</span><span class="p">)</span>
          <span class="p">{</span>
              <span class="n">pathItemDoc</span><span class="p">.</span><span class="n">Operations</span><span class="p">[</span><span class="n">OperationType</span><span class="p">.</span><span class="n">Get</span><span class="p">].</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">OpenApiParameter</span><span class="p">()</span>
              <span class="p">{</span>
                  <span class="n">Name</span> <span class="p">=</span> <span class="s">"customParameter"</span><span class="p">,</span>
                  <span class="n">Schema</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">OpenApiSchema</span><span class="p">()</span> <span class="p">{</span> <span class="n">Type</span> <span class="p">=</span> <span class="s">"string"</span><span class="p">},</span>
                  <span class="n">In</span> <span class="p">=</span> <span class="n">ParameterLocation</span><span class="p">.</span><span class="n">Header</span>
              <span class="p">});</span>
          <span class="p">}</span>
      <span class="p">};</span>
  <span class="p">});</span>
</code></pre></div></div>

<h3 id="the-gateway-documentation-itself">The Gateway documentation itself</h3>

<p>When using the Ocelot gateway as an orchestrator <em>(a specific type of aggregation)</em>, you will probably want to view the documentation for the gateway itself.</p>

<p>In these scenarios, you can also add documentation.</p>

<ol>
  <li>Allow <code class="highlighter-rouge">GenerateDocsForGatewayItSelf</code> option in configuration section.</li>
</ol>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">services</span><span class="p">.</span><span class="nf">AddSwaggerForOcelot</span><span class="p">(</span><span class="n">Configuration</span><span class="p">,</span>
  <span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="p">=&gt;</span>
  <span class="p">{</span>
      <span class="n">o</span><span class="p">.</span><span class="n">GenerateDocsForGatewayItSelf</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
  <span class="p">});</span>
</code></pre></div></div>

<ol>
  <li>Use Swagger generator in <code class="highlighter-rouge">Configure</code> section.</li>
</ol>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="nf">UseSwagger</span><span class="p">();</span>
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/Burgyn/MMLib.SwaggerForOcelot/master/demo/ocelotdocs.png" alt="ocelot docs" /></p>

<h3 id="demo-sample">Demo sample</h3>

<p><a href="https://github.com/Burgyn/Sample.ApiGatewayOcelot">Sample.ApiGatewayOcelot</a></p>

    </div>

    <div class="carousel">
        
    </div>

    <a class="u-url" href="/2021/02/04/swagger-documentation-of-ocelot-aggregates" hidden></a>

</article>

            <script data-name="BMC-Widget" data-cfasync="false" 
                src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" 
                data-id="minomartiniak" 
                data-description="Support me on Buy me a coffee!" 
                data-message="" 
                data-color="#00BF63" data-position="Right" 
                data-x_margin="25" 
                data-y_margin="50">
            </script>
        </div>
    </main><footer class="footer">
  <span>
    &copy; <time datetime="2024-10-30 07:44:44 +0000">2024</time> Milan Martiniak
    <a rel="me" href="https://github.com/burgyn"
      title="GitHub - burgyn">
      <span class="fa fa-github" aria-label="GitHub"></span>
    </a>
    <a rel="me" href="https://twitter.com/minomartiniak"
      title="Twitter - minomartiniak">
      <span class="fa fa-twitter" aria-label="Twitter"></span>
    </a>
    <a rel="me" href="https://linkedin.com/in/milanmartiniak" title="LinkedIn - Milan Martiniak">
      <span class="fa fa-linkedin" aria-label="LinkedIn"></span>
    </a>

    <a rel="me" href="https://blog.burgyn.online/feed.xml" title="RSS feed">
      <span class="fa fa-rss" aria-label="RSS"></span>
    </a>
  </span>
</footer><script type="text/javascript">
        $(document).ready(function () {
            $('.carousel').slick({
                dots: true,
                infinite: true,
                speed: 300,
                slidesToShow: 1,
                centerMode: false,
                focusOnSelect: true,
                infinite: false,
                adaptiveHeight: true
            });
        });

        lightbox.option({
            'resizeDuration': 50,
            'wrapAround': false,
            'fadeDuration': 50,
            'imageFadeDuration': 50,
            'resizeDuration': 50            
        })

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>

</html>